---
title: WIL | ë¸”ë¡œê·¸ ëŒ“ê¸€ ê¸°ëŠ¥ ì¶”ê°€
date: 2025-08-09
desc: Giscusë¡œ ë¸”ë¡œê·¸ ëŒ“ê¸€ ê¸°ëŠ¥ ì¶”ê°€í•˜ê¸°
---

# Giscusë¡œ ë¸”ë¡œê·¸ ëŒ“ê¸€ ê¸°ëŠ¥ ì¶”ê°€í•˜ê¸°

ì‚¬ìš©ìì˜ api ì¤‘ë³µ í˜¸ì¶œì€ UI ë‹¨ì—ì„œ `isLoading`ì„ í†µí•´ ì²˜ë¦¬í•  ìˆ˜ ìˆì§€ë§Œ ìŠ¤í¬ë¦½íŠ¸ ë“±ì„ í†µí•œ ì¤‘ë³µ ìš”ì²­ì´ ë“¤ì–´ì˜¤ëŠ” ê²½ìš° í•´ë‹¹ íšŸìˆ˜ë§Œí¼ apiê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ **React Query ê¸°ë°˜ì˜ ì»¤ìŠ¤í…€ í›…ì„ êµ¬í˜„**í–ˆìŠµë‹ˆë‹¤.

---

## â‰ï¸ ê¸°ì¡´ ë°©ì‹(ref, throttle)ì˜ ë¬¸ì œì 

1. **`ref`ë¥¼ í†µí•´ `isDisabled`ë¥¼ ê´€ë¦¬** <br/>
   `mutation`ì„ ì‚¬ìš©í•˜ëŠ” ê³³ë§ˆë‹¤ ì½”ë“œë¥¼ ì‘ì„±í•´ì£¼ì–´ì•¼í•¨

2. **`throttle`ì´ë‚˜ `debounce`ë¡œ ì»¨íŠ¸ë¡¤** <br/>
   ì¼ì • ì‹œê°„ë™ì•ˆ api í˜¸ì¶œì„ ë§‰ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ì§€ì •í•´ë‘” ì‹œê°„ì´ ë˜ê¸° ì „ê¹Œì§€ ì¶”ê°€ì ì¸ ê¸°ëŠ¥ì´ ë¶ˆê°€ëŠ¥í•¨

## ğŸš¦ ì¤‘ìš” í¬ì¸íŠ¸

- ìš”ì²­ ì¤‘ë³µì„ ì‹ë³„í•  ìˆ˜ ìˆëŠ” í‚¤(`mutationKey`)ë¥¼ ì‚¬ìš©
- ìš”ì²­ ì¤‘ì´ë¼ë©´ ë¬´ì‹œí•˜ê³ , ì™„ë£Œë˜ë©´ ë‹¤ì‹œ ìš”ì²­ ê°€ëŠ¥
- ì¤‘ë³µ í˜¸ì¶œëœ ê²½ìš° `onSuccess`ë‚˜ `onSettled` ë“±ì˜ ì½œë°±ì´ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ì²˜ë¦¬

## ğŸ“– ì½”ë“œ ì •ë¦¬

### 1. íƒ€ì… ì •ì˜

```typescript
interface UsePreventDuplicateMutationProps<TData, TError, TVariables> {
  mutationKey: string; // ì¤‘ë³µ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê¸° ìœ„í•œ key
  mutationFn: (variables: TVariables) => Promise<TData>; // ì‹¤ì œ api í•¨ìˆ˜
  // í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ê³³ì—ì„œ onSuccess, onError ë“±ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ì„¤ì •
  options?: Omit<
    UseMutationOptions<TData, TError, TVariables>,
    "mutationFn" | "mutationKey"
  >;
}
```

- ì¤‘ë³µ ìš”ì²­ì„ ì‹ë³„í•˜ê¸° ìœ„í•œ `key`
- ì‹¤ì œ API ìš”ì²­ í•¨ìˆ˜ì™€ React query ì˜µì…˜ ì¼ë¶€ë¥¼ ê°€ì ¸ì˜´

### 2. ìš”ì²­ ì¶”ì ì„ ìœ„í•œ Set ì„ ì–¸

```typescript
const activeMutations = new Set<string>();
```

- ìš”ì²­ ì¤‘ì¸ `mutationKey`ë¥¼ ì €ì¥í•˜ëŠ” `Set`
- ì¤‘ë³µ íŒë‹¨ì— ì‚¬ìš©ë¨

### 3. ì»¤ìŠ¤í…€ í›… ì •ì˜

```typescript
const usePreventDuplicateMutation = <TData, TError, TVariables>({...}) => {
  return useMutation<TData | undefined, TError, TVariables>({
    ...
}
```

- `useMutation`ì„ ê°ì‹¸ëŠ” í˜•íƒœ
- ë°˜í™˜ íƒ€ì…ì€ ì¤‘ë³µ ì‹œ `undefinedê°€` ë˜ë¯€ë¡œ `TData | undefined` ì²˜ë¦¬

### 4. mutationFn ë¡œì§

```typescript
mutationFn: async (variables) => {
  // 1. ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— Setì— í•´ë‹¹ í‚¤ê°€ ìˆëŠ”ì§€ í™•ì¸
  if (activeMutations.has(mutationKey)) {
    console.warn("ì¤‘ë³µ í˜¸ì¶œ ë¬´ì‹œ!");
    // 2. í•´ë‹¹ í‚¤ê°€ ìˆìœ¼ë©´ ì¤‘ë³µìœ¼ë¡œ íŒë‹¨í•˜ì—¬ ê²½ê³  ì¶œë ¥ + undefined ë°˜í™˜
    return Promise.resolve(undefined);
  }
  // 3. ì¤‘ë³µì´ ì•„ë‹ˆë©´ Setì— í‚¤ë¥¼ ì¶”ê°€í•˜ì—¬ ì§„í–‰
  activeMutations.add(mutationKey);

  try {
    // 4. ì‹¤ì œ api ìš”ì²­
    return await mutationFn(variables);
  } finally {
    // 5. ìš”ì²­ì´ ëë‚˜ë©´ Setì—ì„œ í•´ë‹¹ í‚¤ ì œê±°
    activeMutations.delete(mutationKey);
  }
};
```

- ì¤‘ë³µ ì—¬ë¶€ë¥¼ `Set`ìœ¼ë¡œ íŒë‹¨
- ìš”ì²­ ì™„ë£Œ í›„ì—ëŠ” `Set`ì—ì„œ í•´ë‹¹ `key` ì œê±°

### 5. ì‚¬ìš© ì˜ˆì‹œ

```typescript
export const useUpdate = (id: string) =>
  usePreventDuplicateMutation({
    mutationKey: `update-${id}`,
    mutationFn: () => updateAPI(id),
  });
```

- `id` ê¸°ë°˜ìœ¼ë¡œ `mutationKey`ë¥¼ ê³ ì •
- ê°™ì€ `id`ë¡œ ì¤‘ë³µ ìš”ì²­ ì‹œ í˜¸ì¶œ ë¬´ì‹œ

### ğŸ’› ì „ì²´ ì½”ë“œ

```typescript
import type { UseMutationOptions } from "@tanstack/react-query";
import { useMutation } from "@tanstack/react-query";

interface UsePreventDuplicateMutationProps<TData, TError, TVariables> {
  mutationKey: string;
  mutationFn: (variables: TVariables) => Promise<TData>;
  options?: Omit<
    UseMutationOptions<TData, TError, TVariables>,
    "mutationFn" | "mutationKey"
  >;
}

const activeMutations = new Set<string>();

const usePreventDuplicateMutation = <TData, TError, TVariables>({
  mutationKey,
  mutationFn,
  options,
}: UsePreventDuplicateMutationProps<TData, TError, TVariables>) => {
  return useMutation<TData | undefined, TError, TVariables>({
    mutationFn: async (variables: TVariables): Promise<TData | undefined> => {
      if (activeMutations.has(mutationKey)) {
        console.warn("Duplicate request ignored");
        return Promise.resolve(undefined);
      }
      activeMutations.add(mutationKey);

      try {
        return await mutationFn(variables);
      } finally {
        activeMutations.delete(mutationKey);
      }
    },
    ...options,
    onSuccess: (data, variables, context) => {
      if (data === undefined) return; //NOTE: ë¯¸ì„¤ì • ì‹œ ì¤‘ë³µ í˜¸ì¶œ íšŸìˆ˜ë§Œí¼ ë™ì‘

      options?.onSuccess?.(data, variables, context);
    },
    onError: (error, variables, context) => {
      options?.onError?.(error, variables, context);
    },
    onSettled: (data, error, variables, context) => {
      if (data === undefined) return; //NOTE: ë¯¸ì„¤ì • ì‹œ ì¤‘ë³µ í˜¸ì¶œ íšŸìˆ˜ë§Œí¼ ë™ì‘
      options?.onSettled?.(data, error, variables, context);
    },
  });
};

export default usePreventDuplicateMutation;
```

---

ì°¸ê³ 

[ì°¸ê³ í•œ ë¸”ë¡œê·¸](https://d5br5.dev/blog/nextjs_blog/giscus)
[Giscus ì‚¬ì´íŠ¸](https://giscus.app/ko)
